---
alwaysApply: false
description: "High-level overview of the VMT project architecture, entry points, and key algorithms."
---
## VMT Project Overview

**VMT** is a deterministic spatial agent-based simulation for teaching and researching microeconomic behavior. It implements a 7-phase discrete-time tick cycle on an N×N grid where agents engage in bilateral barter trading and resource foraging.

See `core-invariants.mdc` for critical setup requirements, determinism rules, and type invariants.

### Architecture Map

- **Core Engine**: [src/vmt_engine/core/](mdc:src/vmt_engine/core/) - `Agent`, `Inventory`, `Quote`, `Grid`, `SpatialIndex`
- **Economics**: [src/vmt_engine/econ/utility.py](mdc:src/vmt_engine/econ/utility.py) - `UCES`, `ULinear`, zero-safe epsilon handling
- **Systems**: [src/vmt_engine/systems/](mdc:src/vmt_engine/systems/) - All 7 phases, `find_compensating_block` for price search
- **Scenarios**: [src/scenarios/schema.py](mdc:src/scenarios/schema.py), [src/scenarios/loader.py](mdc:src/scenarios/loader.py)
- **Telemetry**: [src/telemetry/](mdc:src/telemetry/) - SQLite batching to `./logs/telemetry.db`
- **GUI**: [src/vmt_launcher/](mdc:src/vmt_launcher/), [src/vmt_log_viewer/](mdc:src/vmt_log_viewer/), [src/vmt_pygame/](mdc:src/vmt_pygame/)

**Note**: The `llm_counter/` directory is a separate utility and not part of the VMT codebase. It should be ignored in all code analysis and edits.

### Entry Points

- **CLI with viz**: `python main.py scenarios/three_agent_barter.yaml --seed 42`
- **GUI launcher**: `python launcher.py`
- **Log viewer**: `python view_logs.py`
- **Programmatic** (requires `PYTHONPATH=.:src`):
  ```python
  from vmt_engine.simulation import Simulation
  from scenarios.loader import load_scenario
  from telemetry.config import LogConfig
  sim = Simulation(load_scenario("scenarios/three_agent_barter.yaml"), seed=42, log_config=LogConfig.debug())
  sim.run(max_ticks=100)
  ```

### Key Algorithms

- **Trading**: One attempt per pair per tick. `find_compensating_block` scans ΔA ∈ [1..dA_max] and candidate prices to find integer-feasible trades with ΔU > 0 for both. See [src/vmt_engine/systems/matching.py](mdc:src/vmt_engine/systems/matching.py) and [trading.py](mdc:src/vmt_engine/systems/trading.py)
- **Movement**: Manhattan distance with deterministic tie-breakers (reduce |dx| first, prefer negative on ties). See [src/vmt_engine/systems/movement.py](mdc:src/vmt_engine/systems/movement.py)
- **Quotes**: Computed from reservation bounds with spread; only refresh when `inventory_changed=True`. See [src/vmt_engine/systems/quotes.py](mdc:src/vmt_engine/systems/quotes.py)
- **Spatial queries**: Use [SpatialIndex](mdc:src/vmt_engine/core/spatial_index.py) bucketed structure for O(N) average proximity checks

### Versioning Policy

- **No SemVer or numeric versions** until explicitly authorized
- **Use date+time-based naming** (e.g., `2025-10-19-1430`) for versions, branches, tags, snapshots
- Do not add or update version badges
- Reference changes by date-time identifiers in PRs and changelogs

### Documentation Hub

- **Project Overview**: [docs/1_project_overview.md](mdc:docs/1_project_overview.md)
- **Technical Manual**: [docs/2_technical_manual.md](mdc:docs/2_technical_manual.md)
- **Strategic Roadmap**: [docs/3_strategic_roadmap.md](mdc:docs/3_strategic_roadmap.md)
- **Type Contracts**: [docs/4_typing_overview.md](mdc:docs/4_typing_overview.md)
